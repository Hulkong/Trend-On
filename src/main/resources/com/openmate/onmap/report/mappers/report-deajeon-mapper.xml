<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.openmate.onmap.report.service.OnmapReportDeajeonDao">
  
  <!-- 경제트렌드 시작 -->
  <!-- 1. 행정동별 유입인구 소비 -->	
  <!-- 5page text -->
  <select id="rpt-trnd-deajeon-005-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
     SELECT SUM(A.SALE_AMT) AS SALE_AMT  
          , SUM(A.SALE_CNT) AS SALE_CNT  
          , SUM(B.SALE_AMT) AS TOT_SALE_AMT 
          , SUM(B.SALE_CNT) AS TOT_SALE_CNT
          , ROUND(SUM(A.SALE_AMT)/SUM(B.SALE_AMT)*100,1) AS AMT_RATE
          , ROUND(SUM(A.SALE_CNT)/SUM(B.SALE_CNT)*100,1) AS CNT_RATE
       FROM ( SELECT 
                     SUM(A.SALE_AMT) AS SALE_AMT  
                   , SUM(A.SALE_CNT) AS SALE_CNT
                FROM      
                     tbcty_visit_upjong_info_d A
                WHERE 1=1
                 AND A.STDR_DATE between #{startDate} AND  #{endDate}
                  AND CTY_CD = substr(#{ctyCd},1,4)
            ) A
          , ( SELECT 
                     SUM(A.SALE_AMT) AS SALE_AMT  
                   , SUM(A.SALE_CNT) AS SALE_CNT
                FROM      
                     tbadmi_info_d2 A
                WHERE 1=1
                 AND A.STDR_DATE between #{startDate} AND  #{endDate}
                  AND CTY_CD = substr(#{ctyCd},1,4)
             )B  
  ]]>
  </select>
  
  <!-- 5page [그림 2] 행정동별 유입인구 소비금액 주제도 -->
  <select id="rpt-trnd-deajeon-005-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT B.NM  AS ADMI_NM 
         , SUM(SALE_AMT) AS SALE_AMT 
         , ROUND(SUM(A.SALE_AMT) / SUM(SUM(A.SALE_AMT)) OVER() * 100, 1) AS RATE    
         , NTILE(5) OVER( ORDER BY SUM(SALE_AMT) DESC) AS GRD
         , B.ID 
      FROM tbadmi_info_d2 A
         , TBREGION B 
     WHERE 1=1    
       AND STDR_DATE between #{startDate} AND  #{endDate}
       AND CTY_CD = substr(#{ctyCd},1,4)
       AND B.RGN_CLSS = 'H4'
       AND A.ADMI_CD = B.ID
    GROUP BY B.NM ,B.ID 
  ]]>
  </select> 
  
  <!-- 2. 업종별 유입인구 소비 -->
  <!-- 6page 유입인구 활성(최다 소비)업종 TEXT + 그림3 -->
  <select id="rpt-trnd-deajeon-006-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT B.CODE
         , B.CD_NM	-- 업종명
         , SUM(SALE_AMT) AS SALE_AMT -- 텍스트에서 사용될 소비금액      
         , ROUND(SUM(SALE_AMT) / (SUM(SUM(SALE_AMT)) OVER()) *100,1) RATE -- 비율
      FROM tbcty_visit_upjong_info_d A
         , TBCOMM_CODE B
     WHERE 1=1
       AND A.UPJONG2_CD = B.CODE
       AND B.CD_ID ='UPJONG2_CD'
      AND A.STDR_DATE between #{startDate} AND  #{endDate}
       AND CTY_CD = substr(#{ctyCd},1,4)
     GROUP BY  B.CODE , B.CD_NM
     ORDER BY 3 DESC
     LIMIT 10  
  ]]>
  </select>
  
  <!-- 6page 유입인구 특화 소비 업종 TEXT + 그림4 -->
  <select id="rpt-trnd-deajeon-006-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT T1.CD_NM  
         , T1.SALE_AMT       
         , ROUND(T1.RATE / T2.RATE*100,1) AS RATE    
      FROM (
          SELECT B.CD_NM
               , SUM(SALE_AMT) SALE_AMT  
               , SUM(SALE_AMT) / (SUM(SUM(SALE_AMT)) OVER()) RATE
            FROM tbcty_visit_upjong_info_d A
               , TBCOMM_CODE B
           WHERE 1=1
             AND A.UPJONG2_CD = B.CODE
             AND B.CD_ID ='UPJONG2_CD'
            AND A.STDR_DATE between #{startDate} AND  #{endDate}
             AND CTY_CD = substr(#{ctyCd},1,4)
           GROUP BY CD_NM
        ) T1
        ,
        (
          SELECT B.CD_NM
               , SUM(SALE_AMT) / (SUM(SUM(SALE_AMT)) OVER()) RATE
            FROM tbmega_upjong_info_d A
               , TBCOMM_CODE B
           WHERE 1=1
             AND A.UPJONG2_CD = B.CODE
             AND B.CD_ID ='UPJONG2_CD'
             AND A.STDR_DATE between #{startDate} AND  #{endDate}
             AND A.MEGA_CD LIKE SUBSTR(#{ctyCd},1,2)||'%'
           GROUP BY CD_NM
        ) T2
      WHERE 1=1
        AND T1.CD_NM = T2.CD_NM
      ORDER BY 3 DESC
      LIMIT 10
  ]]>
  </select> 
  
  <!-- 3. 시간대별 유입인구 소비 -->
  <!-- 7page text1 + 그림5. 시간대별 상주인구/유입인구 소비비율 -->
  <select id="rpt-trnd-deajeon-007-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
     SELECT B.CD_NM   
          , ROUND(SUM(CASE WHEN LOC_CLSS_CD = 'E' THEN  TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS E_RATE         
          , ROUND(SUM(CASE WHEN LOC_CLSS_CD = 'R' THEN  TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS H_RATE  
      FROM TBADMI_TIMEZON_INFO_D A
         , TBCOMM_CODE B  
     WHERE 1=1
       AND A.TIMEZON_CD = B.CODE
      AND A.STDR_DATE between #{startDate} AND  #{endDate}
       AND CTY_CD like #{ctyCd}||'%'
       AND CD_ID ='TIMEZON_CD'
    GROUP BY CD_NM   
    ORDER BY 2 DESC
  ]]>
  </select>
  
  <!-- 7page text2 -->
  <select id="rpt-trnd-deajeon-007-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
	SELECT T.CD_NM
	     , ABS(T.E_TOTAL_CNT - T.H_TOTAL_CNT) AS GAP
	  FROM (
	         SELECT B.CD_NM   
			  	  , ROUND(SUM(CASE WHEN LOC_CLSS_CD = 'E' THEN TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS E_TOTAL_CNT         
			  	  , ROUND(SUM(CASE WHEN LOC_CLSS_CD = 'R' THEN TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS H_TOTAL_CNT  
		       FROM TBADMI_TIMEZON_INFO_D A
			 	  , TBCOMM_CODE B  
		      WHERE 1=1
		        AND A.TIMEZON_CD = B.CODE
		        AND A.STDR_DATE between #{startDate} AND  #{endDate}
		        AND CTY_CD like #{ctyCd}||'%'
		        AND CD_ID ='TIMEZON_CD'
		      GROUP BY CD_NM   
	    ) AS T
	ORDER BY 2 DESC
	LIMIT 1
  ]]>
  </select>
  
  <!-- 4. 성/연령대별 유입인구 소비 -->
  <!-- 7page 유입인구 text1 -->
  <select id="rpt-trnd-deajeon-007-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
	 SELECT CHR
	      , SUM_CNT
	      , ROUND((SUM_CNT /TOTAL_CNT)*100,1) AS RATE
	  FROM      
	      (
		      SELECT (CASE GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT)
		                , SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) 
		                WHEN SUM(M_20_CNT) THEN '20대 남성'
		                WHEN SUM(M_30_CNT) THEN '30대 남성'
		                WHEN SUM(M_40_CNT) THEN '40대 남성' 
		                WHEN SUM(M_50_CNT) THEN '50대 남성' 
		                WHEN SUM(M_60_CNT) THEN '60대 남성' 
		                WHEN SUM(F_20_CNT) THEN '20대 여성' 
		                WHEN SUM(F_30_CNT) THEN '30대 여성' 
		                WHEN SUM(F_40_CNT) THEN '40대 여성' 
		                WHEN SUM(F_50_CNT) THEN '50대 여성' 
		                WHEN SUM(F_60_CNT) THEN '60대 여성' 
		          END) CHR,
		         GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT), SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) AS SUM_CNT
		     FROM TBCTY_VISIT_INFO_D
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND #{endDate}
		       AND CTY_CD like #{ctyCd}||'%'
		       AND LOC_CLSS_CD ='E'
	      ) T1
	      ,(
		      SELECT SUM(TOTAL_CNT) AS  TOTAL_CNT
		     FROM TBCTY_VISIT_INFO_D
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND #{endDate}
		       AND CTY_CD like #{ctyCd}||'%'
	      )T2
    ]]>
  </select>
  
   <!-- 7page 상주인구 text2 -->
  <select id="rpt-trnd-deajeon-007-004" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  	 SELECT CHR
	      , SUM_CNT
	      , ROUND((SUM_CNT /TOTAL_CNT)*100,1) AS RATE
	  FROM      
	      (
		      SELECT (CASE GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT)
		                , SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) 
		                WHEN SUM(M_20_CNT) THEN '20대 남성'
		                WHEN SUM(M_30_CNT) THEN '30대 남성'
		                WHEN SUM(M_40_CNT) THEN '40대 남성' 
		                WHEN SUM(M_50_CNT) THEN '50대 남성' 
		                WHEN SUM(M_60_CNT) THEN '60대 남성' 
		                WHEN SUM(F_20_CNT) THEN '20대 여성' 
		                WHEN SUM(F_30_CNT) THEN '30대 여성' 
		                WHEN SUM(F_40_CNT) THEN '40대 여성' 
		                WHEN SUM(F_50_CNT) THEN '50대 여성' 
		                WHEN SUM(F_60_CNT) THEN '60대 여성' 
		          END) CHR,
		          GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT), SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) AS SUM_CNT
		     FROM TBCTY_VISIT_INFO_D
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND  #{endDate}
		       AND CTY_CD like #{ctyCd}||'%'
		       AND LOC_CLSS_CD ='R'
	       ) T1
	      ,(
		      SELECT SUM(TOTAL_CNT) AS  TOTAL_CNT
		     FROM TBCTY_VISIT_INFO_D
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND #{endDate}
		       AND CTY_CD like #{ctyCd}||'%'
	      )T2
    ]]>
  </select>  
  
   <!-- 7page 그림6. 성/연령대별 상주인구/유입인구 소비비율  -->
  <select id="rpt-trnd-deajeon-007-005" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
       SELECT 
              ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_20_CNT END)/SUM(total_cnt)*100,1) AS H_M_20_CNT  
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_20_CNT END)/SUM(total_cnt)*100,1) AS H_F_20_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_20_CNT         END)/SUM(total_cnt)*100,1) AS E_M_20_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_20_CNT         END)/SUM(total_cnt)*100,1) AS E_F_20_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_30_CNT END)/SUM(total_cnt)*100,1) AS H_F_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_30_CNT END)/SUM(total_cnt)*100,1) AS H_M_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_30_CNT         END)/SUM(total_cnt)*100,1) AS E_F_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_30_CNT         END)/SUM(total_cnt)*100,1) AS E_M_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_40_CNT END)/SUM(total_cnt)*100,1) AS H_F_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_40_CNT END)/SUM(total_cnt)*100,1) AS H_M_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_40_CNT         END)/SUM(total_cnt)*100,1) AS E_F_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_40_CNT         END)/SUM(total_cnt)*100,1) AS E_M_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_50_CNT END)/SUM(total_cnt)*100,1) AS H_F_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_50_CNT END)/SUM(total_cnt)*100,1) AS H_M_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_50_CNT         END)/SUM(total_cnt)*100,1) AS E_F_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_50_CNT         END)/SUM(total_cnt)*100,1) AS E_M_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_60_CNT END)/SUM(total_cnt)*100,1) AS H_F_60_CNT 
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_60_CNT END)/SUM(total_cnt)*100,1) AS H_M_60_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_60_CNT         END)/SUM(total_cnt)*100,1) AS E_F_60_CNT  
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_60_CNT         END)/SUM(total_cnt)*100,1) AS E_M_60_CNT
         FROM TBCTY_VISIT_INFO_D
        WHERE 1=1
          AND CTY_CD like #{ctyCd}||'%'
          AND STDR_DATE >= #{startDate} 
          AND STDR_DATE <=#{endDate}
    ]]>
  </select>
  
  <!-- 5. 유입인구 주요 유입지역 -->
  <!-- 8page 표1. 유입인구 유입지역 순위 1 ~ 20 -->
  <select id="rpt-trnd-deajeon-008-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT B.FULL_NAME AS NM
           , SUM(IN_CNT) AS IN_CNT 
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM TBCTY_INFLOW_INFO_D A
           , TBREGION B
       WHERE 1=1
         AND A.IN_CTY_CD = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{ctyCd},1,4)
        AND A.STDR_DATE between #{startDate} AND  #{endDate}
         AND CTY_CD like #{ctyCd}||'%'
         AND B.RGN_CLSS ='H2'
       GROUP BY B.FULL_NAME
       ORDER BY 2 DESC
       LIMIT 20
    ]]>
  </select>
  
  <!-- 8page 시도 유입지역 text -->
  <select id="rpt-trnd-deajeon-008-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT   B.FULL_NAME AS NM
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM TBCTY_INFLOW_INFO_D A
           , TBREGION B 
       WHERE 1=1
         AND CTY_CD like #{ctyCd}||'%'
         AND SUBSTR(A.IN_CTY_CD,1,2) = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{ctyCd},1,4)
         AND B.RGN_CLSS ='H1'
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
      GROUP BY B.FULL_NAME 
      ORDER BY 2 DESC
      LIMIT 3  
  ]]>
  </select>
  
  <!-- 8page 그림7,8. 유입인구 유입지역 분포 주제도 -->
  <select id="rpt-trnd-deajeon-008-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT B.ID 
         , B.NM
           , SUM(IN_CNT) AS IN_CNT 
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM TBCTY_INFLOW_INFO_D A
           , TBREGION B
       WHERE 1=1
         AND A.IN_CTY_CD = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{ctyCd},1,4)
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
         AND CTY_CD like #{ctyCd}||'%'
         AND B.RGN_CLSS ='H2'
      GROUP BY B.NM, B.ID
      ORDER BY 2 DESC
  ]]>
  </select>
  
  <!-- 6. 업종별 매출액 -->
  <!-- 9page [그림 6] 업종별 매출액 (단위: 백만원) -->
  <select id="rpt-trnd-deajeon-009-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
       SELECT B.CODE
            , B.CD_NM  
            , SUM(SALE_AMT) AS SALE_AMT 
            , ROUND(SUM(SALE_AMT) / (SUM(SUM(SALE_AMT)) OVER()) *100,1) RATE 
         FROM tbcty_upjong_info_d A
            , TBCOMM_CODE B
        WHERE 1=1
          AND A.UPJONG2_CD = B.CODE
          AND B.CD_ID ='UPJONG2_CD'
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
          AND CTY_CD = SUBSTR(#{ctyCd},1,4)
       GROUP BY B.CODE
              , B.CD_NM   
       ORDER BY 3 DESC 
       LIMIT 10
  ]]>
  </select>
  
  <!-- 경제트렌드 끝 -->
  
  <!-- 이벤트효과 시작-->
  <!-- 1. 행정동별 유입인구 소비 -->	
  <!--  5page text01 : 선택기간의 매출변화 -->
  <select id="rpt-evntEff-deajeon-005-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT SUBSTR(#{startDate},1,4)||'년 '||SUBSTR(#{startDate},5,2)||'월 '||SUBSTR(#{startDate},7,2)||'일 '||'~ '||SUBSTR(#{endDate},1,4)||'년 '||SUBSTR(#{endDate},5,2)||'월 '||SUBSTR(#{endDate},7,2)||'일' as period
           , TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1 as days
           , SUM(TOTAL_CNT) AS TOTAL_CNT 
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND ADMI_CD = #{admiCd}
         AND A.STDR_DATE between #{startDate} AND  #{endDate}       
  ]]>
  </select>
  
  <!--  5page text01 : 비교기간의 매출변화 -->
  <select id="rpt-evntEff-deajeon-005-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT SUBSTR(#{lastStartDate},1,4)||'년 '||SUBSTR(#{lastStartDate},5,2)||'월 '||SUBSTR(#{lastStartDate},7,2)||'일 '||'~ '||SUBSTR(#{lastEndDate},1,4)||'년 '||SUBSTR(#{lastEndDate},5,2)||'월 '||SUBSTR(#{lastEndDate},7,2)||'일' as period
           , TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1 as days
           , SUM(TOTAL_CNT) AS TOTAL_CNT 
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND ADMI_CD = #{admiCd}
         AND A.STDR_DATE between #{lastStartDate} AND  #{lastEndDate}        
  ]]>
  </select>
  
  <!--  5page text06 : 비교기간 대비 매출액 -->
  <select id="rpt-evntEff-deajeon-005-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  SELECT (CASE WHEN AVG_RATE > 0 THEN '증가' ELSE '감소' END) AS AVG_TEXT
       , (CASE WHEN SUM_RATE > 0 THEN '증가' ELSE '감소' END) AS SUM_TEXT
       , AVG_RATE
       , AVG_CNT
       , SUM_RATE
       , SUM_CNT
    FROM (
	     SELECT ROUND((T1.AVG_CNT - T2.AVG_CNT) / T2.AVG_CNT *100,1) AS AVG_RATE
	          , ROUND(T1.AVG_CNT - T2.AVG_CNT, 0) AS AVG_CNT
	          , ROUND((T1.TOTAL_CNT - T2.TOTAL_CNT) / T2.TOTAL_CNT *100,1) AS SUM_RATE
	          , T1.TOTAL_CNT - T2.TOTAL_CNT AS SUM_CNT
	      FROM
	          (
	            SELECT (SUM(TOTAL_CNT) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_CNT
	                 , SUM(TOTAL_CNT) AS TOTAL_CNT
	              FROM TBADMI_UPJONG_INFO_D A
	             WHERE 1=1
	               AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	               AND SALE_AMT > 0
	               AND SALE_CNT > 0                
	          ) T1
	        ,(
	            SELECT (SUM(TOTAL_CNT) / (#{lastEndDate}::date - #{lastStartDate}::date + 1)) AS AVG_CNT
	                 , SUM(TOTAL_CNT) AS TOTAL_CNT
	              FROM TBADMI_UPJONG_INFO_D A
	             WHERE 1=1
		           AND A.STDR_DATE BETWEEN #{lastStartDate} AND #{lastEndDate}
	               AND ADMI_CD = #{admiCd}
	               AND SALE_AMT > 0
	               AND SALE_CNT > 0	               
	         ) T2
	       WHERE 1=1
	       ) TT1
	  WHERE 1=1
  ]]>
  </select> 

  <!--  5page text07 :  선택기간 매출 라인 그래프 -->
  <select id="rpt-evntEff-deajeon-005-004" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW3  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW2    
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW1  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN TOTAL_CNT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1))) AS TERM
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN TOTAL_CNT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD')))) AS TOT_TERM  
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
		                        THEN TOTAL_CNT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 7
		                      THEN TOTAL_CNT / 7		              
		     ELSE NULL END)) AS AW1 
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW1 
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
		                        THEN TOTAL_CNT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 14
		                        THEN TOTAL_CNT/ 7		                        
		     ELSE NULL END)) AS AW2
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW2  
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
         AND ADMI_CD = #{admiCd}
         AND TOTAL_CNT > 0
         AND SALE_CNT > 0          
  ]]>
  </select> 
  
  <!--  5page text08 :  비교기간 매출 라인 그래프 -->
  <select id="rpt-evntEff-deajeon-005-005" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW2   
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW1  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN TOTAL_CNT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1))) AS TERM
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN TOTAL_CNT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD')))) AS TOT_TERM 
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
		                        THEN TOTAL_CNT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 7
		                      THEN TOTAL_CNT / 7		              
		     ELSE NULL END)) AS AW1 
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW1 
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
		                        THEN TOTAL_CNT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 14
		                        THEN TOTAL_CNT/ 7		                        
		     ELSE NULL END)) AS AW2               
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW2
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') 
         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
         AND ADMI_CD = #{admiCd}
         AND TOTAL_CNT > 0
         AND SALE_CNT > 0          
  ]]>
  </select>   

  <!--  5page text07 :  선택기간 표 비율 -->
  <select id="rpt-evntEff-deajeon-005-006" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  WITH A AS (
		SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW3  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW1  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN TOTAL_CNT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1))) AS TERM
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN TOTAL_CNT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD')))) AS TOT_TERM  
     		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
		                        THEN TOTAL_CNT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 7
		                      THEN TOTAL_CNT / 7		              
		         ELSE NULL END))          AS AW1 
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW1 
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
		                        THEN TOTAL_CNT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 14
		                        THEN TOTAL_CNT/ 7		                        
		     ELSE NULL END)) AS AW2
		   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW2
	        FROM TBADMI_UPJONG_INFO_D A
	       WHERE 1=1
	         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
	         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
	         AND ADMI_CD = #{admiCd}
	         AND TOTAL_CNT > 0
	         AND SALE_CNT > 0	         
	)
	, B AS (SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW2   
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END) / 7) AS LW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_LW1  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN TOTAL_CNT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1))) AS TERM
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN TOTAL_CNT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD')))) AS TOT_TERM 
	    	   , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
		                        THEN TOTAL_CNT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 7
		                      THEN TOTAL_CNT / 7		              
		         ELSE NULL END))                                                                                                                                                                       AS AW1 
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW1 
		       , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
		                        THEN TOTAL_CNT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                                WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 14
		                        THEN TOTAL_CNT/ 7		                        
		         ELSE NULL END)) AS AW2               
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN TOTAL_CNT END)) AS TOT_AW2
	        FROM TBADMI_UPJONG_INFO_D A
	       WHERE 1=1
	         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') 
	         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
	         AND ADMI_CD = #{admiCd}
	         AND TOTAL_CNT > 0
	         AND SALE_CNT > 0	         
	     )
	
	 
	SELECT ROUND((A.LW3 - B.LW3) / B.LW3 *100,1) AS LW3
	     , ROUND((A.LW2 - B.LW2) / B.LW2 *100,1) AS LW2
	     , ROUND((A.LW1 - B.LW1) / B.LW1 *100,1) AS LW1
	     , ROUND((A.TERM - B.TERM) / B.TERM *100,1) AS TERM
	     , ROUND((A.AW1 - B.AW1) / B.AW1 *100,1) AS AW1
	     , ROUND((A.AW2 - B.AW2) / B.AW2 *100,1) AS AW2
	     
	  FROM A, B
  ]]>
  </select> 	
  
  <!-- 1. 행정동별 유입인구 소비 -->	
  <!--  5page text01 : 선택기간의 매출변화 -->
  <select id="rpt-evntEff-deajeon-006-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT SUBSTR(#{startDate},1,4)||'년 '||SUBSTR(#{startDate},5,2)||'월 '||SUBSTR(#{startDate},7,2)||'일 '||'~ '||SUBSTR(#{endDate},1,4)||'년 '||SUBSTR(#{endDate},5,2)||'월 '||SUBSTR(#{endDate},7,2)||'일' as period
           , TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1 as days
           , SUM(SALE_CNT) AS TOT_SALE_CNT 
           , SUM(SALE_AMT) AS TOT_SALE_AMT 
           , ROUND(SUM(SALE_CNT)/(TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1)) AS AVG_CNT
           , ROUND(SUM(SALE_AMT)/(TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1)) AS AVG_AMT
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND ADMI_CD = #{admiCd}
         AND A.STDR_DATE between #{startDate} AND  #{endDate}        
  ]]>
  </select>
  
  <!--  5page text01 : 비교기간의 매출변화 -->
  <select id="rpt-evntEff-deajeon-006-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT SUBSTR(#{lastStartDate},1,4)||'년 '||SUBSTR(#{lastStartDate},5,2)||'월 '||SUBSTR(#{lastStartDate},7,2)||'일 '||'~ '||SUBSTR(#{lastEndDate},1,4)||'년 '||SUBSTR(#{lastEndDate},5,2)||'월 '||SUBSTR(#{lastEndDate},7,2)||'일' as period
           , TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1 as days
           , SUM(SALE_CNT) AS TOT_SALE_CNT 
           , SUM(SALE_AMT) AS TOT_SALE_AMT 
           , ROUND(SUM(SALE_CNT)/(TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1)) AS AVG_CNT
           , ROUND(SUM(SALE_AMT)/(TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1)) AS AVG_AMT
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND ADMI_CD = #{admiCd}
         AND A.STDR_DATE between #{lastStartDate} AND  #{lastEndDate}          
  ]]>
  </select>
  
  <!--  5page text06 : 비교기간 대비 매출액 -->
  <select id="rpt-evntEff-deajeon-006-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  SELECT (CASE WHEN AVG_RATE > 0 THEN '증가' ELSE '감소' END) AS AVG_TEXT
       , (CASE WHEN SUM_RATE > 0 THEN '증가' ELSE '감소' END) AS SUM_TEXT
       , AVG_RATE
       , AVG_AMT
       , SUM_RATE
       , SUM_AMT
    FROM (
	     SELECT ROUND((T1.AVG_AMT - T2.AVG_AMT) / T2.AVG_AMT *100,1) AS AVG_RATE
	          , ROUND(T1.AVG_AMT - T2.AVG_AMT, 0) AS AVG_AMT
	          , ROUND((T1.SUM_AMT - T2.SUM_AMT) / T2.SUM_AMT *100,1) AS SUM_RATE
	          , T1.SUM_AMT - T2.SUM_AMT AS SUM_AMT
	      FROM
	          (
	            SELECT (SUM(SALE_AMT) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_AMT
	                 , SUM(SALE_AMT) AS SUM_AMT
	              FROM TBADMI_UPJONG_INFO_D A
	             WHERE 1=1
	               AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	               AND SALE_AMT > 0
	               AND SALE_CNT > 0	               
	          ) T1
	        ,(
	            SELECT (SUM(SALE_AMT) / (#{lastEndDate}::date - #{lastStartDate}::date + 1)) AS AVG_AMT
	                 , SUM(SALE_AMT) AS SUM_AMT
	              FROM TBADMI_UPJONG_INFO_D A
	             WHERE 1=1
		           AND A.STDR_DATE BETWEEN #{lastStartDate} AND #{lastEndDate}
	               AND ADMI_CD = #{admiCd}
	               AND SALE_AMT > 0
	               AND SALE_CNT > 0              
	         ) T2
	       WHERE 1=1
	       ) TT1
	  WHERE 1=1
  ]]>
  </select> 

  <!--  5page text07 :  선택기간 매출 라인 그래프 -->
  <select id="rpt-evntEff-deajeon-006-004" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  
      SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW3  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW2    
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW1  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN SALE_AMT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1))) AS TERM
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN SALE_AMT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD')))) AS TOT_TERM  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
                        THEN SALE_AMT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)
                        WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 7
                        THEN SALE_AMT / 7
	         ELSE NULL END)) AS AW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW1 
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
                       THEN SALE_AMT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                       WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 14
                       THEN SALE_AMT/ 7		                        
             ELSE NULL END)) AS AW2  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW2
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
         AND ADMI_CD = #{admiCd}
         AND SALE_AMT > 0
         AND SALE_CNT > 0    
  ]]>
  </select> 
  
  <!--  5page text08 :  비교기간 매출 라인 그래프 -->
  <select id="rpt-evntEff-deajeon-006-005" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW3
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW2   
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW1  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN SALE_AMT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1))) AS TERM
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN SALE_AMT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD')))) AS TOT_TERM 
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
                        THEN SALE_AMT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)
                        WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 7
                        THEN SALE_AMT / 7
	         ELSE NULL END)) AS AW1
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW1  
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
                       THEN SALE_AMT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr)-7)
                       WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 14
                       THEN SALE_AMT/ 7		                        
             ELSE NULL END)) AS AW2
           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW2
        FROM TBADMI_UPJONG_INFO_D A
       WHERE 1=1
         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') 
         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
         AND ADMI_CD = #{admiCd}
         AND SALE_AMT > 0
         AND SALE_CNT > 0         
  ]]>
  </select>   

  <!--  5page text07 :  선택기간 표 비율 -->
  <select id="rpt-evntEff-deajeon-006-006" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
  WITH A AS (
		SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW3  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW1  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN SALE_AMT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD') +1))) AS TERM
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{startDate} AND #{endDate} THEN SALE_AMT END)/((TO_DATE(#{endDate},'YYYYMMDD') - TO_DATE(#{startDate},'YYYYMMDD')))) AS TOT_TERM  
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
                        THEN SALE_AMT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)
                        WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 7
                        THEN SALE_AMT / 7
	             ELSE NULL END)) AS AW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW1 
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
                       THEN SALE_AMT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr)-7)
                       WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{endDate},'YYYYMMDD') from tbcom_stdr) > 14
                       THEN SALE_AMT/ 7
                 ELSE NULL END)) AS AW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW2
	        FROM TBADMI_UPJONG_INFO_D A
	       WHERE 1=1
	         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
	         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
	         AND ADMI_CD = #{admiCd}
	         AND SALE_AMT > 0
	         AND SALE_CNT > 0	 
	)
	, B AS (SELECT ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -15,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW3
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -14,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 8,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW2   
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END) / 7) AS LW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 7,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') - 1,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_LW1  
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN SALE_AMT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD') +1))) AS TERM
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  #{lastStartDate} AND #{lastEndDate} THEN SALE_AMT END)/((TO_DATE(#{lastEndDate},'YYYYMMDD') - TO_DATE(#{lastStartDate},'YYYYMMDD')))) AS TOT_TERM 
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) between  1 and 7
                        THEN SALE_AMT /(select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr)
                        WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD')
                        AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 7
                        THEN SALE_AMT / 7
	             ELSE NULL END)) AS AW1
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 7,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW1  
               , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) BETWEEN 8 AND 14
                       THEN SALE_AMT/((select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr)-7)
                       WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
                       AND (select (to_date(stdr_ym,'YYYYMM') + INTERVAL '1 MONTH - 1 day')::date  -  TO_DATE(#{lastEndDate},'YYYYMMDD') from tbcom_stdr) > 14
                       THEN SALE_AMT/ 7
                 ELSE NULL END)) AS AW2
	           , ROUND(SUM(CASE WHEN STDR_DATE BETWEEN  TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 8,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') + 14,'YYYYMMDD') THEN SALE_AMT END)) AS TOT_AW2
	        FROM TBADMI_UPJONG_INFO_D A
	       WHERE 1=1
	         AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{lastStartDate},'YYYYMMDD') -21,'YYYYMMDD') 
	         AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{lastEndDate},'YYYYMMDD') +14,'YYYYMMDD')
	         AND ADMI_CD = #{admiCd}
	         AND SALE_AMT > 0
	         AND SALE_CNT > 0
	     )
	
	SELECT ROUND((A.LW3 - B.LW3) / B.LW3 *100,1) AS LW3
	     , ROUND((A.LW2 - B.LW2) / B.LW2 *100,1) AS LW2
	     , ROUND((A.LW1 - B.LW1) / B.LW1 *100,1) AS LW1
	     , ROUND((A.TERM - B.TERM) / B.TERM *100,1) AS TERM
	     , ROUND((A.AW1 - B.AW1) / B.AW1 *100,1) AS AW1
	     , ROUND((A.AW2 - B.AW2) / B.AW2 *100,1) AS AW2
	     , ROUND((A.TOT_LW3 - B.TOT_LW3) / B.TOT_LW3 *100,1) AS TOT_LW3
	     , ROUND((A.TOT_LW2 - B.TOT_LW2) / B.TOT_LW2 *100,1) AS TOT_LW2
	     , ROUND((A.TOT_LW1 - B.TOT_LW1) / B.TOT_LW1 *100,1) AS TOT_LW1
	     , ROUND((A.TOT_TERM - B.TOT_TERM) / B.TOT_TERM *100,1) AS TOT_TERM
	     , ROUND((A.TOT_AW1 - B.TOT_AW1) / B.TOT_AW1 *100,1) AS TOT_AW1
	     , ROUND((A.TOT_AW2 - B.TOT_AW2) / B.TOT_AW2 *100,1) AS TOT_AW2
	     
	  FROM A, B
  ]]>
  </select>
  
  <!-- 7page   주제도2 주변지역 매출액 변화  -->
  <select id="rpt-evntEff-deajeon-007-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    <![CDATA[
    SELECT CASE WHEN RATE > 0 THEN '증가' ELSE '감소' END AS TEXT
         , NM
         , ID
         , AMT
         , RATE
      FROM (
		     SELECT T1.NM 
		     	  , T1.ID 
		          , ROUND((T1.AVG_AMT - T2.AVG_AMT)) AS AMT
		          , ROUND((T1.AVG_AMT - T2.AVG_AMT)/T2.AVG_AMT *100 , 1) AS RATE
		      FROM
		          (
		          SELECT B.NM
		          	   , B.ID
		               , (SUM(SALE_AMT) /  (#{endDate}::date - #{startDate}::date +1)) AS AVG_AMT     
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND A.STDR_DATE >= #{startDate}
		             AND A.STDR_DATE <= #{endDate}
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0
		             AND ADMI_CD = #{admiCd}  		             
		        GROUP BY B.NM   , B.ID
		          ) T1
		        ,(
		          SELECT B.NM      
		               , B.ID
		               , (SUM(SALE_AMT) / 35) AS AVG_AMT
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B    
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
		              OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0
		             AND ADMI_CD = #{admiCd}		             
		         GROUP BY B.NM   , B.ID
		         ) T2
		         WHERE 1=1
		           AND T1.NM = T2.NM
		  ]]>            
		  UNION ALL
		  <![CDATA[
		     SELECT T1.NM 
		          , T1.ID 
		          , ROUND((T1.AVG_AMT - T2.AVG_AMT)) AS AMT
		          , ROUND((T1.AVG_AMT - T2.AVG_AMT)/T2.AVG_AMT *100 , 1) AS AMT
		      FROM
		          (
		          SELECT B.NM
		               , B.ID
		               , (SUM(SALE_AMT) /  (#{endDate}::date - #{startDate}::date +1)) AS AVG_AMT     
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND A.STDR_DATE >= #{startDate}
		             AND A.STDR_DATE <= #{endDate}
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0	             
		  ]]>              
			<!-- ROW COUNT(1) 3이상 일때 -->
		    <if test='admiAround != null and admiAround != ""'>  
				    		 AND ADMI_CD IN (${admiAround})
		    </if>
		    <!-- ROW COUNT(1) 3 미만 일때 -->
			<if test='admiAround == null or admiAround == ""'> 
				    		 AND ADMI_CD IN (SELECT B.ID  
				    		    			   FROM TBREGION A
				    		    			      , TBREGION B 
				    		    			  WHERE A.ID = #{admiCd} 
				    		    			    AND B.ID like #{ctyCd}||'%'
				    		    			    AND B.ID != #{admiCd}
				    		    			    AND B.RGN_CLSS ='H4' 
				    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
			</if> 
		  <![CDATA[
		        GROUP BY B.NM   , B.ID
		          ) T1
		        ,(
		          SELECT B.NM  
		               , B.ID    
		               , (SUM(SALE_AMT) / 35) AS AVG_AMT
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B    
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
		              OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0		             
		  ]]>              
			<!-- ROW COUNT(1) 3이상 일때 -->
		    <if test='admiAround != null and admiAround != ""'>  
				    		 AND ADMI_CD IN (${admiAround})
		    </if>
		    <!-- ROW COUNT(1) 3 미만 일때 -->
			<if test='admiAround == null or admiAround == ""'> 
				    		 AND ADMI_CD IN (SELECT B.ID  
				    		    			   FROM TBREGION A
				    		    			      , TBREGION B 
				    		    			  WHERE A.ID = #{admiCd} 
				    		    			    AND B.ID like #{ctyCd}||'%'
				    		    			    AND B.ID != #{admiCd}
				    		    			    AND B.RGN_CLSS ='H4' 
				    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
			</if> 
		  <![CDATA[
		        GROUP BY B.NM   , B.ID
		         ) T2
		         WHERE 1=1
		           AND T1.NM = T2.NM
		    ORDER BY 4 DESC
    ) TT1
  ]]> 
  </select> 

  <!-- 7page   주제도2 주변지역 거래량 변화  -->
  <select id="rpt-evntEff-deajeon-007-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    <![CDATA[
    SELECT CASE WHEN RATE > 0 THEN '증가' ELSE '감소' END AS TEXT
         , NM
         , ID
         , CNT
         , RATE
      FROM (
		     SELECT T1.NM 
		      	  , T1.ID
		          , ROUND((T1.AVG_CNT - T2.AVG_CNT)) AS CNT
		          , ROUND((T1.AVG_CNT - T2.AVG_CNT) / T2.AVG_CNT *100,1) AS RATE
		      FROM
		          (
		          SELECT B.NM
		               , B.ID
		               , (SUM(SALE_CNT) /  (#{endDate}::date - #{startDate}::date +1)) AS AVG_CNT    
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND A.STDR_DATE >= #{startDate}
		             AND A.STDR_DATE <= #{endDate}
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0
		             AND ADMI_CD = #{admiCd}   		             
		        GROUP BY B.NM   , B.ID
		          ) T1
		        ,(
		          SELECT B.NM   
		               , B.ID   
		               , (SUM(SALE_CNT) / 35) AS AVG_CNT
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B    
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
		              OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0
		             AND ADMI_CD = #{admiCd} 		             
		         GROUP BY B.NM   , B.ID
		         ) T2
		         WHERE 1=1
		           AND T1.NM = T2.NM
		  ]]>            
		  UNION ALL
		    
		  <![CDATA[
		     SELECT T1.NM 
		          , T1.ID
		          , ROUND((T1.AVG_CNT - T2.AVG_CNT) / T2.AVG_CNT *100,1) AS RATE
		          , ROUND((T1.AVG_CNT - T2.AVG_CNT)) AS CNT
		      FROM
		          (
		          SELECT B.NM
		               , B.ID
		               , (SUM(SALE_CNT) /  (#{endDate}::date - #{startDate}::date +1)) AS AVG_CNT     
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND A.STDR_DATE >= #{startDate}
		             AND A.STDR_DATE <= #{endDate}
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0 		             
		  ]]>              
			<!-- ROW COUNT(1) 3이상 일때 -->
		    <if test='admiAround != null and admiAround != ""'>  
				    		 AND ADMI_CD IN (${admiAround})
		    </if>
		    <!-- ROW COUNT(1) 3 미만 일때 -->
			<if test='admiAround == null or admiAround == ""'> 
				    		 AND ADMI_CD IN (SELECT B.ID  
				    		    			   FROM TBREGION A
				    		    			      , TBREGION B 
				    		    			  WHERE A.ID = #{admiCd} 
				    		    			    AND B.ID like #{ctyCd}||'%'
				    		    			    AND B.ID != #{admiCd}
				    		    			    AND B.RGN_CLSS ='H4' 
				    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
			</if> 
		  <![CDATA[
		        GROUP BY B.NM   , B.ID
		          ) T1
		        ,(
		          SELECT B.NM   
		               , B.ID   
		               , (SUM(SALE_CNT) / 35) AS AVG_CNT
		            FROM TBADMI_UPJONG_INFO_D A
		               , TBREGION B    
		           WHERE 1=1
		             AND A.ADMI_CD = B.ID
		             AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
		              OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
		             AND SALE_AMT > 0
		             AND SALE_CNT > 0 		             
		  ]]>              
			<!-- ROW COUNT(1) 3이상 일때 -->
		    <if test='admiAround != null and admiAround != ""'>  
				    		 AND ADMI_CD IN (${admiAround})
		    </if>
		    <!-- ROW COUNT(1) 3 미만 일때 -->
			<if test='admiAround == null or admiAround == ""'> 
				    		 AND ADMI_CD IN (SELECT B.ID  
				    		    			   FROM TBREGION A
				    		    			      , TBREGION B 
				    		    			  WHERE A.ID = #{admiCd} 
				    		    			    AND B.ID like #{ctyCd}||'%'
				    		    			    AND B.ID != #{admiCd}
				    		    			    AND B.RGN_CLSS ='H4' 
				    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
			</if>  
		  <![CDATA[
		        GROUP BY B.NM   , B.ID
		         ) T2
		         WHERE 1=1
		           AND T1.NM = T2.NM
		    ORDER BY 4 DESC
    ) TT1
  ]]> 
  </select>
  
  <!-- 6page text01 업종별 -->
  <select id="rpt-evntEff-deajeon-008-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
     SELECT T1.CODE
          , T1.CD_NM 
          , ROUND(T1.AVG_AMT - T2.AVG_AMT) AS AVG_AMT
          , ROUND((T1.AVG_AMT - T2.AVG_AMT) / T2.AVG_AMT *100,1) AS RATE
          , ROUND(T1.AVG_AMT) AS AMT
      FROM
          (
            SELECT B.CD_NM
                 , B.CODE 
                 , (SUM(SALE_AMT) /  (#{endDate}::date - #{startDate}::date +1)) AS AVG_AMT
              FROM TBADMI_UPJONG_INFO_D A
                 , TBCOMM_CODE B    
             WHERE 1=1
               AND A.UPJONG2_CD = B.CODE
               AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
               AND ADMI_CD = #{admiCd}
               AND SALE_AMT > 0
               AND SALE_CNT > 0
		          AND UPJONG2_CD NOT IN (SELECT DISTINCT UPJONG2_CD
		                                   FROM TBADMI_UPJONG_INFO_D a
		                                   WHERE 1=1
		                                     AND ADMI_CD = #{admiCd}
                                             AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
                                             AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                                     AND STORE_CNT_FLG = 'N'
		                                )                 
          GROUP BY B.CODE,B.CD_NM
          ) T1
        ,(
            SELECT B.CD_NM
                 , B.CODE   
                 , (SUM(SALE_AMT) / 35) AS AVG_AMT
              FROM TBADMI_UPJONG_INFO_D A
                 , TBCOMM_CODE B    
             WHERE 1=1
               AND A.UPJONG2_CD = B.CODE
               AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
                OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
               AND ADMI_CD = #{admiCd}
               AND SALE_AMT > 0
               AND SALE_CNT > 0
		          AND UPJONG2_CD NOT IN (SELECT DISTINCT UPJONG2_CD
		                                   FROM TBADMI_UPJONG_INFO_D a
		                                   WHERE 1=1
		                                     AND ADMI_CD = #{admiCd}
                                             AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
                                             AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                                     AND STORE_CNT_FLG = 'N'
		                                )                 
          GROUP BY B.CODE,B.CD_NM
         ) T2
       WHERE 1=1
         AND T1.CD_NM = T2.CD_NM
     ORDER BY 4 DESC
     LIMIT 10
  ]]>
  </select>
  
  <!-- 6page text02 -->
  <select id="rpt-evntEff-deajeon-008-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
     SELECT T1.CODE
          , T1.CD_NM 
          , ROUND(T1.AVG_CNT - T2.AVG_CNT) AS AVG_CNT
          , ROUND((T1.AVG_CNT - T2.AVG_CNT) / T2.AVG_CNT *100,1) AS RATE
          , ROUND(T1.AVG_CNT) AS CNT
      FROM
          (
            SELECT B.CD_NM
                 , B.CODE 
                 , (SUM(SALE_CNT) /  (#{endDate}::date - #{startDate}::date + 1) ) AS AVG_CNT
              FROM TBADMI_UPJONG_INFO_D A
                 , TBCOMM_CODE B    
             WHERE 1=1
               AND A.UPJONG2_CD = B.CODE
               AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
               AND ADMI_CD = #{admiCd}
               AND SALE_AMT > 0
               AND SALE_CNT > 0
		          AND UPJONG2_CD NOT IN (SELECT DISTINCT UPJONG2_CD
		                                   FROM TBADMI_UPJONG_INFO_D a
		                                   WHERE 1=1
		                                     AND ADMI_CD = #{admiCd}
                                             AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
                                             AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                                     AND STORE_CNT_FLG = 'N'
		                                )                 
          GROUP BY B.CODE,B.CD_NM
          ) T1
        ,(
            SELECT B.CD_NM
                 , B.CODE   
                 , (SUM(SALE_CNT) / 35) AS AVG_CNT
              FROM TBADMI_UPJONG_INFO_D A
                 , TBCOMM_CODE B    
             WHERE 1=1
               AND A.UPJONG2_CD = B.CODE
               AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
                OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
               AND ADMI_CD = #{admiCd}
               AND SALE_AMT > 0
               AND SALE_CNT > 0
		          AND UPJONG2_CD NOT IN (SELECT DISTINCT UPJONG2_CD
		                                   FROM TBADMI_UPJONG_INFO_D a
		                                   WHERE 1=1
		                                     AND ADMI_CD = #{admiCd}
                                             AND A.STDR_DATE >= TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') -21,'YYYYMMDD') 
                                             AND A.STDR_DATE <= TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') +14,'YYYYMMDD')
		                                     AND STORE_CNT_FLG = 'N'
		                                )                 
          GROUP BY B.CODE,B.CD_NM
         ) T2
       WHERE 1=1
         AND T1.CD_NM = T2.CD_NM
     ORDER BY 4 DESC
     LIMIT 10
  ]]>
  </select>
  
  <!-- 9page TEXT-03 -->
  <select id="rpt-evntEff-deajeon-009-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[  
  	SELECT CASE WHEN RATE > 0 THEN '증가' ELSE '감소' END AS TEXT
  	     , NM
  	     , ID
  	     , RATE
  	     , AVG_TCNT
  	  FROM (
	         SELECT T1.NM 
			 	  , T1.ID
			      , ROUND((T1.AVG_TCNT - T2.AVG_TCNT) / T2.AVG_TCNT *100,1) AS RATE
			      , T1.AVG_TCNT
			  FROM
			      (
			      SELECT B.NM  
			      	   , B.ID   
			           , (SUM(total_cnt) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0
                     AND ADMI_CD = #{admiCd}
			    GROUP BY B.NM , B.ID 
			      ) T1
			    ,(
			      SELECT B.NM      
			           , (SUM(TOTAL_CNT) / 35) AS AVG_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
			         	OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0
	                 AND ADMI_CD = #{admiCd}                
			    GROUP BY B.NM   
			     ) T2
			     WHERE 1=1
			       AND T1.NM = T2.NM
			   ) TT1
		    
  ]]>
  </select>	  
  
  <!-- 9page TEXT-04 -->
  <select id="rpt-evntEff-deajeon-009-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	<![CDATA[	    
	    	      SELECT T1.NM 
			 	  , T1.ID
			      , ROUND((T1.AVG_TCNT - T2.AVG_TCNT) / T2.AVG_TCNT *100,1) AS RATE
			      , ROUND(T1.AVG_TCNT) AS AVG_TCNT
			      , ROUND(T1.TOTAL_TCNT) AS TOTAL_TCNT
			  FROM
			      (
			      SELECT B.NM  
			      	   , B.ID   
			           , (SUM(total_cnt) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_TCNT
			           , SUM(total_cnt) AS TOTAL_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0	         
	]]>
	<!-- ROW COUNT(1) 3이상 일때 -->
    <if test='admiAround != null and admiAround != ""'>   
    <![CDATA[		       
		    		 AND ADMI_CD IN (${admiAround})
	]]>			 
    </if>
    <!-- ROW COUNT(1) 3 미만 일때 -->
	<if test='admiAround == null or admiAround == ""'> 
		    		 AND ADMI_CD IN (SELECT B.ID  
		    		    			   FROM TBREGION A
		    		    			      , TBREGION B 
		    		    			  WHERE A.ID = #{admiCd} 
		    		    			    AND B.ID like #{ctyCd}||'%'
		    		    			    AND B.ID != #{admiCd}
		    		    			    AND B.RGN_CLSS ='H4' 
		    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
	</if>   
    <![CDATA[
			    GROUP BY B.NM , B.ID 
			      ) T1
			    ,(
			      SELECT B.NM      
			           , (SUM(TOTAL_CNT) / 35) AS AVG_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
			         	OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0			         
	]]>
	<!-- ROW COUNT(1) 3이상 일때 -->
    <if test='admiAround != null and admiAround != ""'>   
    <![CDATA[		       
		    		 AND ADMI_CD IN (${admiAround})
	]]>			 
    </if>
    <!-- ROW COUNT(1) 3 미만 일때 -->
	<if test='admiAround == null or admiAround == ""'> 
		    		 AND ADMI_CD IN (SELECT B.ID  
		    		    			   FROM TBREGION A
		    		    			      , TBREGION B 
		    		    			  WHERE A.ID = #{admiCd} 
		    		    			    AND B.ID like #{ctyCd}||'%'
		    		    			    AND B.ID != #{admiCd}
		    		    			    AND B.RGN_CLSS ='H4' 
		    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
	</if>
    <![CDATA[
			    GROUP BY B.NM   
			     ) T2
			     WHERE 1=1
			       AND T1.NM = T2.NM
			       ORDER BY 3 DESC
	]]>
  </select>

  <!-- 9page 주제도 -->
  <select id="rpt-evntEff-deajeon-009-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	<![CDATA[

	    	      SELECT T1.NM 
			 	  , T1.ID
			      , ROUND((T1.AVG_TCNT - T2.AVG_TCNT) / T2.AVG_TCNT *100,1) AS RATE
			      , T1.AVG_TCNT
			      , T1.TOTAL_TCNT
			  FROM
			      (
			      SELECT B.NM  
			      	   , B.ID   
			           , (SUM(total_cnt) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_TCNT
			           , SUM(total_cnt) AS TOTAL_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0
                     AND ADMI_CD = #{admiCd}                     
			    GROUP BY B.NM , B.ID 
			      ) T1
			    ,(
			      SELECT B.NM      
			           , (SUM(TOTAL_CNT) / 35) AS AVG_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
			         	OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0
	                 AND ADMI_CD = #{admiCd} 	                 
			    GROUP BY B.NM   
			     ) T2
			     WHERE 1=1
			       AND T1.NM = T2.NM

			       UNION ALL	
     
	    	      SELECT T1.NM 
			 	  , T1.ID
			      , ROUND((T1.AVG_TCNT - T2.AVG_TCNT) / T2.AVG_TCNT *100,1) AS RATE
			      , T1.AVG_TCNT
			      , T1.TOTAL_TCNT
			  FROM
			      (
			      SELECT B.NM  
			      	   , B.ID   
			           , (SUM(total_cnt) / (#{endDate}::date - #{startDate}::date + 1)) AS AVG_TCNT
			           , SUM(total_cnt) AS TOTAL_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND A.STDR_DATE BETWEEN #{startDate} AND #{endDate}
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0			         
	]]>
	<!-- ROW COUNT(1) 3이상 일때 -->
    <if test='admiAround != null and admiAround != ""'>   
    <![CDATA[		       
		    		 AND ADMI_CD IN (${admiAround})
	]]>			 
    </if>
    <!-- ROW COUNT(1) 3 미만 일때 -->
	<if test='admiAround == null or admiAround == ""'> 
		    		 AND ADMI_CD IN (SELECT B.ID  
		    		    			   FROM TBREGION A
		    		    			      , TBREGION B 
		    		    			  WHERE A.ID = #{admiCd} 
		    		    			    AND B.ID like #{ctyCd}||'%'
		    		    			    AND B.ID != #{admiCd}
		    		    			    AND B.RGN_CLSS ='H4' 
		    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
	</if>   
    <![CDATA[
			    GROUP BY B.NM , B.ID 
			      ) T1
			    ,(
			      SELECT B.NM      
			           , (SUM(TOTAL_CNT) / 35) AS AVG_TCNT
			        FROM tbadmi_visit_upjong_info_d A
			           , TBREGION B    
			       WHERE 1=1
			         AND A.ADMI_CD = B.ID
			         AND ( A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 21,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{startDate},'YYYYMMDD') - 1,'YYYYMMDD')
			         	OR A.STDR_DATE BETWEEN TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 1,'YYYYMMDD') AND TO_CHAR(TO_DATE(#{endDate},'YYYYMMDD') + 14,'YYYYMMDD'))
 			         AND SALE_AMT > 0
			         AND SALE_CNT > 0		         
	]]>
	<!-- ROW COUNT(1) 3이상 일때 -->
    <if test='admiAround != null and admiAround != ""'>   
    <![CDATA[		       
		    		 AND ADMI_CD IN (${admiAround})
	]]>			 
    </if>
    <!-- ROW COUNT(1) 3 미만 일때 -->
	<if test='admiAround == null or admiAround == ""'> 
		    		 AND ADMI_CD IN (SELECT B.ID  
		    		    			   FROM TBREGION A
		    		    			      , TBREGION B 
		    		    			  WHERE A.ID = #{admiCd} 
		    		    			    AND B.ID like #{ctyCd}||'%'
		    		    			    AND B.ID != #{admiCd}
		    		    			    AND B.RGN_CLSS ='H4' 
		    		    			  ORDER BY ST_Distance(A.SHAPE,B.SHAPE) LIMIT 3)
	</if>
    <![CDATA[
			    GROUP BY B.NM   
			     ) T2
			     WHERE 1=1
			       AND T1.NM = T2.NM
			       ORDER BY 3 DESC
	]]>
	</select>
	
  <!-- 10page  TEXT 3 -->
  <select id="rpt-evntEff-deajeon-010-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    	 SELECT CHR
	      , SUM_CNT
	      , ROUND((SUM_CNT /TOTAL_CNT)*100,1) AS RATE
	  FROM      
	      (
		    SELECT (CASE GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT)
		                , SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) 
		                WHEN SUM(M_20_CNT) THEN '20대 남성'
		                WHEN SUM(M_30_CNT) THEN '30대 남성'
		                WHEN SUM(M_40_CNT) THEN '40대 남성' 
		                WHEN SUM(M_50_CNT) THEN '50대 남성' 
		                WHEN SUM(M_60_CNT) THEN '60대 남성' 
		                WHEN SUM(F_20_CNT) THEN '20대 여성' 
		                WHEN SUM(F_30_CNT) THEN '30대 여성' 
		                WHEN SUM(F_40_CNT) THEN '40대 여성' 
		                WHEN SUM(F_50_CNT) THEN '50대 여성' 
		                WHEN SUM(F_60_CNT) THEN '60대 여성' 
		          END) CHR,
		          GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT), SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) AS SUM_CNT
		     FROM TBADMI_VISIT_INFO_D_NEW
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND  #{endDate}
		       AND ADMI_CD = #{admiCd}
		       AND LOC_CLSS_CD ='E'
    	  ) T1
	      ,(
		      SELECT SUM(TOTAL_CNT) AS  TOTAL_CNT
		     FROM TBADMI_VISIT_INFO_D_NEW
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND #{endDate}
		       AND ADMI_CD = #{admiCd}
	      )T2
  ]]>
  </select>
  

  <!-- 12page  TEXT 4 -->
  <select id="rpt-evntEff-deajeon-010-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    	 SELECT CHR
	      , SUM_CNT
	      , ROUND((SUM_CNT /TOTAL_CNT)*100,1) AS RATE
	  FROM      
	      (
		    SELECT (CASE GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT)
		                , SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) 
		                WHEN SUM(M_20_CNT) THEN '20대 남성'
		                WHEN SUM(M_30_CNT) THEN '30대 남성'
		                WHEN SUM(M_40_CNT) THEN '40대 남성' 
		                WHEN SUM(M_50_CNT) THEN '50대 남성' 
		                WHEN SUM(M_60_CNT) THEN '60대 남성' 
		                WHEN SUM(F_20_CNT) THEN '20대 여성' 
		                WHEN SUM(F_30_CNT) THEN '30대 여성' 
		                WHEN SUM(F_40_CNT) THEN '40대 여성' 
		                WHEN SUM(F_50_CNT) THEN '50대 여성' 
		                WHEN SUM(F_60_CNT) THEN '60대 여성' 
		          END) CHR,
		          GREATEST(SUM(M_20_CNT), SUM(M_30_CNT), SUM(M_40_CNT), SUM(M_50_CNT), SUM(M_60_CNT), SUM(F_20_CNT), SUM(F_30_CNT), SUM(F_40_CNT), SUM(F_50_CNT), SUM(F_60_CNT)) AS SUM_CNT
		     FROM TBADMI_VISIT_INFO_D_NEW
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND  #{endDate}
		       AND ADMI_CD = #{admiCd}
		       AND LOC_CLSS_CD ='R'
		  ) T1
	      ,(
		      SELECT SUM(TOTAL_CNT) AS  TOTAL_CNT
		     FROM TBADMI_VISIT_INFO_D_NEW
		     WHERE 1=1
		       AND STDR_DATE between #{startDate} AND #{endDate}
		       AND ADMI_CD = #{admiCd}
	      )T2
  ]]>
  </select>
    
  <select id="rpt-evntEff-deajeon-010-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
       SELECT ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_20_CNT END)/SUM(total_cnt)*100,1) AS E_M_20_CNT  
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_30_CNT END)/SUM(total_cnt)*100,1) AS E_M_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_40_CNT END)/SUM(total_cnt)*100,1) AS E_M_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_50_CNT END)/SUM(total_cnt)*100,1) AS E_M_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         M_60_CNT END)/SUM(total_cnt)*100,1) AS E_M_60_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_20_CNT END)/SUM(total_cnt)*100,1) AS E_F_20_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_30_CNT END)/SUM(total_cnt)*100,1) AS E_F_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_40_CNT END)/SUM(total_cnt)*100,1) AS E_F_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_50_CNT END)/SUM(total_cnt)*100,1) AS E_F_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='E' THEN         F_60_CNT END)/SUM(total_cnt)*100,1) AS E_F_60_CNT  
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_20_CNT END)/SUM(total_cnt)*100,1) AS H_M_20_CNT  
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_30_CNT END)/SUM(total_cnt)*100,1) AS H_M_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_40_CNT END)/SUM(total_cnt)*100,1) AS H_M_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_50_CNT END)/SUM(total_cnt)*100,1) AS H_M_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN M_60_CNT END)/SUM(total_cnt)*100,1) AS H_M_60_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_20_CNT END)/SUM(total_cnt)*100,1) AS H_F_20_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_30_CNT END)/SUM(total_cnt)*100,1) AS H_F_30_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_40_CNT END)/SUM(total_cnt)*100,1) AS H_F_40_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_50_CNT END)/SUM(total_cnt)*100,1) AS H_F_50_CNT
            , ROUND(SUM(CASE  WHEN LOC_CLSS_CD ='R' THEN F_60_CNT END)/SUM(total_cnt)*100,1) AS H_F_60_CNT 
         FROM TBADMI_VISIT_INFO_D_NEW
        WHERE 1=1
          AND ADMI_CD = #{admiCd}
          AND STDR_DATE >= #{startDate} 
          AND STDR_DATE <=#{endDate}
      ]]> 
  </select>
  
   <!-- 12page text04 -->
  <select id="rpt-evntEff-deajeon-010-004" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
	SELECT T.CD_NM
	     , ABS(T.E_TOTAL_CNT - T.H_TOTAL_CNT) AS GAP
	  FROM (
        SELECT B.CD_NM      
	           , ROUND(SUM(CASE WHEN LOC_CLSS_CD ='E' THEN TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS E_TOTAL_CNT
			   , ROUND(SUM(CASE WHEN LOC_CLSS_CD ='R' THEN  TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS H_TOTAL_CNT  
	        FROM TBCOMM_CODE B
	        LEFT OUTER JOIN 
	             (SELECT 
  	                     '1' as TIMEZON_CD
  	                   , LOC_CLSS_CD  
  	                   , sum(timezon_cd_1_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	             group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '2' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_2_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '3' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_3_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '4' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_4_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '5' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_5_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '6' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_6_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	
	               group by LOC_CLSS_CD 
	               union ALL
                  SELECT 
  	                     '7' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_7_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	
	               group by LOC_CLSS_CD 
 	             )A
	          ON A.TIMEZON_CD = B.CODE
	         WHERE CD_ID = 'TIMEZON_CD'
	    GROUP BY B.CD_NM
	    ) AS T
	ORDER BY 2 DESC
	LIMIT 1
  ]]>
  </select>
  
  <!-- 12page graph04 -->
  <select id="rpt-evntEff-deajeon-010-005" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
        SELECT B.CD_NM      
	           , ROUND(SUM(CASE WHEN LOC_CLSS_CD ='E' THEN TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS E_TOTAL_CNT
			   , ROUND(SUM(CASE WHEN LOC_CLSS_CD ='R' THEN  TOTAL_CNT END)/SUM(SUM(TOTAL_CNT)) OVER() * 100,1) AS H_TOTAL_CNT  
	        FROM TBCOMM_CODE B
	        LEFT OUTER JOIN 
	             (SELECT 
  	                     '1' as TIMEZON_CD
  	                   , LOC_CLSS_CD  
  	                   , sum(timezon_cd_1_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	             group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '2' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_2_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '3' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_3_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '4' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_4_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '5' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_5_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	               
	               group by LOC_CLSS_CD  
	               UNION ALL
                  SELECT 
  	                     '6' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_6_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	
	               group by LOC_CLSS_CD 
	               union ALL
                  SELECT 
  	                     '7' as TIMEZON_CD
  	                     ,LOC_CLSS_CD
  	                   , sum(timezon_cd_7_cnt) as TOTAL_CNT
  	                   , COUNT(DISTINCT STDR_DATE) STDR_DATE
	                FROM
	                TBADMI_TIMEZON_INFO_D_U2
	             WHERE 1=1   
	        	   AND STDR_DATE BETWEEN #{startDate} AND #{endDate}
	               AND ADMI_CD = #{admiCd}	
	               group by LOC_CLSS_CD 
 	             )A
	          ON A.TIMEZON_CD = B.CODE
	         WHERE CD_ID = 'TIMEZON_CD'
	    GROUP BY B.CD_NM
    ORDER BY 2 DESC
  ]]>
  </select>
  
  <!-- 10page text02 -->
  <select id="rpt-evntEff-deajeon-011-001" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT   B.FULL_NAME AS NM
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM tbadmi_inflow_info_d_u2 A
           , TBREGION B 
       WHERE 1=1
         AND admi_cd = #{admiCd}
         AND SUBSTR(A.IN_CTY_CD,1,2) = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{admiCd},1,4)
         AND B.RGN_CLSS ='H1'
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
      GROUP BY B.FULL_NAME 
      ORDER BY 2 DESC
      LIMIT 3  
  ]]>
  </select>
  
  <!-- 10page 주제도 전국 -->
  <select id="rpt-evntEff-deajeon-011-002" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
    SELECT B.ID 
         , B.NM
           , SUM(IN_CNT) AS IN_CNT 
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM tbadmi_inflow_info_d_u2 A
           , TBREGION B
       WHERE 1=1
         AND A.IN_CTY_CD = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{ctyCd},1,4)
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
         AND admi_cd = #{admiCd}
         AND B.RGN_CLSS ='H2'
      GROUP BY B.NM, B.ID
      ORDER BY 2 DESC
  ]]>      
  </select>
  
  <!-- 10page  표 1 ~ 10 -->
  <select id="rpt-evntEff-deajeon-011-003" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  <![CDATA[
      SELECT B.FULL_NAME AS NM
           , SUM(IN_CNT) AS IN_CNT 
           , ROUND(SUM(IN_CNT) / (SUM(SUM(IN_CNT)) OVER())*100,1) RATE
        FROM tbadmi_inflow_info_d_u2 A
           , TBREGION B
       WHERE 1=1
         AND A.IN_CTY_CD = B.ID
         AND A.IN_CTY_CD <> SUBSTR(#{ctyCd},1,4)
         AND A.STDR_DATE between #{startDate} AND  #{endDate}
         AND admi_cd = #{admiCd}
         AND B.RGN_CLSS ='H2'
      GROUP BY B.FULL_NAME
      ORDER BY 2 DESC
      LIMIT 20
    ]]>    
  </select>
  <!-- 이벤트효과 끝-->
</mapper>
